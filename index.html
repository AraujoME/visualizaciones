<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crisis Oncológica: Precios de Mercado</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- LIBRERÍAS DE GRÁFICAS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>

    <!-- Librería para capturar pantalla -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <style>
        @media print {
            body {
                background-color: white;
            }

            .no-print {
                display: none !important;
            }

            .shadow-2xl {
                box-shadow: none !important;
            }

            .border {
                border: none !important;
            }

            #report-container {
                margin: 0;
                width: 100%;
                box-shadow: none;
                border: none;
            }
        }

        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');

        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>

<body class="bg-stone-50 p-4 md:p-8 font-sans text-stone-800">

    <!-- BARRA DE HERRAMIENTAS -->
    <div class="max-w-6xl mx-auto mb-4 flex justify-end gap-3 no-print">
        <button onclick="downloadImage()"
            class="flex items-center px-4 py-2 bg-white text-slate-700 rounded-lg shadow-sm hover:shadow border border-slate-200 font-semibold transition-all">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                </path>
            </svg>
            Guardar Imagen
        </button>
    </div>

    <!-- REPORT CONTAINER -->
    <div id="report-container"
        class="max-w-6xl mx-auto bg-white rounded-xl shadow-xl overflow-hidden border border-slate-200">

        <!-- ENCABEZADO -->
        <div class="bg-purple-900 p-8 text-white relative overflow-hidden">
            <div class="relative z-10">
                <p class="text-purple-300 font-bold text-xs uppercase tracking-widest mb-1">@SocioNomicsLab</p>
                <h1 class="text-3xl md:text-4xl font-black mb-2 tracking-tight">El costo de sobrevivir: Medicamentos
                    oncológicos</h1>
                <p class="text-purple-100 text-lg font-medium">
                    Evolución del precio promedio en farmacias privadas ante el desabasto público (2012-2025)
                </p>
            </div>
            <div
                class="absolute top-0 right-0 w-80 h-80 bg-fuchsia-600 rounded-full mix-blend-overlay filter blur-[60px] opacity-40 transform translate-x-1/3 -translate-y-1/3">
            </div>
        </div>

        <!-- LEYENDA -->
        <div class="bg-white border-b border-slate-100 p-6">
            <div class="flex flex-wrap justify-center gap-6 text-sm">
                <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-cyan-500 mr-2"></span>Cisplatino
                </div>
                <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-blue-600 mr-2"></span>Carboplatino
                </div>
                <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-pink-500 mr-2"></span>Asparaginasa
                    (Niños)</div>
                <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-purple-600 mr-2"></span>Mitotano
                </div>
                <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-orange-500 mr-2"></span>Hidroxiurea
                </div>
            </div>
        </div>

        <!-- GRÁFICA -->
        <div class="p-8 relative h-[65vh] w-full bg-white">
            <canvas id="chemoChart"></canvas>
        </div>

        <!-- TABLA DE DATOS -->
        <div class="p-8 bg-slate-50 border-t border-slate-200">
            <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center">
                <svg class="w-5 h-5 mr-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z">
                    </path>
                </svg>
                Impacto al bolsillo (Precio Promedio MXN)
            </h3>
            <div class="overflow-x-auto">
                <table class="min-w-full text-sm text-left text-stone-600">
                    <thead class="text-xs text-stone-700 uppercase bg-stone-100">
                        <tr>
                            <th scope="col" class="px-4 py-3 rounded-l-lg">Medicamento</th>
                            <th scope="col" class="px-4 py-3 text-right">2012-2018 (Prom)</th>
                            <th scope="col" class="px-4 py-3 text-right text-red-600 font-bold">2021 (Crisis)</th>
                            <th scope="col" class="px-4 py-3 text-right text-purple-700 font-bold">2025 (Actual)</th>
                            <th scope="col" class="px-4 py-3 rounded-r-lg">Uso Principal</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-stone-100">
                        <tr class="bg-white">
                            <td class="px-4 py-3 font-bold text-cyan-700">Cisplatino (50mg)</td>
                            <td class="px-4 py-3 text-right">$350</td>
                            <td class="px-4 py-3 text-right text-red-600">$2,800</td>
                            <td class="px-4 py-3 text-right font-bold">$1,500</td>
                            <td class="px-4 py-3 text-xs">Testículo, Vejiga, Pulmón</td>
                        </tr>
                        <tr class="bg-white">
                            <td class="px-4 py-3 font-bold text-blue-700">Carboplatino (150mg)</td>
                            <td class="px-4 py-3 text-right">$450</td>
                            <td class="px-4 py-3 text-right text-red-600">$3,200</td>
                            <td class="px-4 py-3 text-right font-bold">$1,250</td>
                            <td class="px-4 py-3 text-xs">Ovario, Pulmón</td>
                        </tr>
                        <tr class="bg-white">
                            <td class="px-4 py-3 font-bold text-pink-700">Asparaginasa</td>
                            <td class="px-4 py-3 text-right">$1,800</td>
                            <td class="px-4 py-3 text-right text-red-600">$4,500</td>
                            <td class="px-4 py-3 text-right font-bold">$3,900</td>
                            <td class="px-4 py-3 text-xs">Leucemia Infantil (ALL)</td>
                        </tr>
                        <tr class="bg-purple-50 border-l-4 border-purple-500">
                            <td class="px-4 py-3 font-bold text-purple-900">Mitotano (100 tabs)</td>
                            <td class="px-4 py-3 text-right">$3,200</td>
                            <td class="px-4 py-3 text-right text-red-600">$12,500</td>
                            <td class="px-4 py-3 text-right font-bold">$18,000*</td>
                            <td class="px-4 py-3 text-xs">Cáncer Adrenal (Importación)</td>
                        </tr>
                        <tr class="bg-white">
                            <td class="px-4 py-3 font-bold text-orange-700">Hidroxiurea</td>
                            <td class="px-4 py-3 text-right">$800</td>
                            <td class="px-4 py-3 text-right text-red-600">$1,400</td>
                            <td class="px-4 py-3 text-right font-bold">$1,950</td>
                            <td class="px-4 py-3 text-xs">Leucemia Crónica</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- FOOTER DE DATOS -->
            <div class="mt-6 flex flex-col md:flex-row justify-between items-start md:items-end gap-4">
                <div class="max-w-2xl">
                    <p class="text-xs text-stone-500 italic leading-relaxed">
                        *Mitotano: Precio de importación actual ante falta de registro sanitario local continuo. <br>
                        Fuente: Recopilación de precios en cadenas de farmacias especializadas, reportes de ONGs (Nariz
                        Roja, Cero Desabasto) e investigaciones de mercado.
                    </p>
                </div>
                <div class="text-right">
                    <p class="text-xs text-purple-600 font-bold uppercase tracking-tighter">Elaborado por Eric Araujo
                    </p>
                </div>
            </div>

            <!-- BLOQUE DE LICENCIA STYLIZED -->
            <div
                class="mt-8 pt-4 border-t border-slate-200 flex flex-col sm:flex-row justify-between items-center gap-3">
                <div class="flex items-center gap-2">
                    <span class="px-2 py-0.5 bg-slate-800 text-white text-[10px] font-bold rounded">MIT</span>
                    <span class="px-2 py-0.5 bg-blue-600 text-white text-[10px] font-bold rounded">CC BY-NC 4.0</span>
                </div>
                <p class="text-[11px] text-slate-400 font-medium">
                    Código bajo licencia <span class="text-slate-600">MIT</span>. Datos y visualización bajo <span
                        class="text-slate-600">CC BY-NC 4.0</span>.
                </p>
            </div>
        </div>
    </div>

    <script>
        Chart.register(ChartDataLabels, window['chartjs-plugin-annotation']);

        const ctx = document.getElementById('chemoChart').getContext('2d');
        const years = ['2012', '2014', '2016', '2018', '2019', '2020', '2021', '2022', '2023', '2024', '2025'];

        const dataCis = [350, 360, 380, 400, 800, 2200, 2800, 2100, 1800, 1600, 1500];
        const dataCarbo = [450, 460, 480, 500, 1200, 2800, 3200, 2400, 1800, 1400, 1250];
        const dataAspa = [1800, 1850, 1900, 2000, 3500, 4200, 4500, 4300, 4100, 4000, 3900];
        const dataMito = [3000, 3200, 3400, 3600, 6000, 9500, 12500, 14000, 15500, 17000, 18000];
        const dataHidro = [800, 850, 900, 950, 1100, 1300, 1400, 1600, 1750, 1850, 1950];

        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: years,
                datasets: [
                    { label: 'Cisplatino', data: dataCis, borderColor: '#06b6d4', backgroundColor: '#06b6d4', borderWidth: 3, pointRadius: 4, tension: 0.3 },
                    { label: 'Carboplatino', data: dataCarbo, borderColor: '#2563eb', backgroundColor: '#2563eb', borderWidth: 3, pointRadius: 4, tension: 0.3 },
                    { label: 'Asparaginasa', data: dataAspa, borderColor: '#ec4899', backgroundColor: '#ec4899', borderWidth: 3, pointRadius: 4, tension: 0.3, borderDash: [5, 5] },
                    { label: 'Mitotano', data: dataMito, borderColor: '#9333ea', backgroundColor: '#9333ea', borderWidth: 4, pointRadius: 4, tension: 0.3 },
                    { label: 'Hidroxiurea', data: dataHidro, borderColor: '#f97316', backgroundColor: '#f97316', borderWidth: 2, pointRadius: 3, tension: 0.3 }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                layout: { padding: { top: 30, right: 80, left: 10, bottom: 10 } },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        backgroundColor: 'rgba(15, 23, 42, 0.95)',
                        callbacks: {
                            label: function (context) {
                                return context.dataset.label + ': $' + new Intl.NumberFormat('es-MX').format(context.raw);
                            }
                        }
                    },
                    datalabels: {
                        align: 'right',
                        anchor: 'end',
                        offset: 6,
                        color: (ctx) => ctx.dataset.borderColor,
                        font: { weight: 'bold', size: 12 },
                        formatter: (val, ctx) => {
                            if (ctx.dataIndex === years.length - 1) {
                                return '$' + new Intl.NumberFormat('es-MX').format(val);
                            }
                            return null;
                        }
                    },
                    annotation: {
                        annotations: {
                            line1: {
                                type: 'line',
                                xMin: 4, xMax: 4,
                                borderColor: '#64748b',
                                borderWidth: 2,
                                borderDash: [2, 2],
                                label: {
                                    content: 'Desmantelamiento Compras',
                                    display: true,
                                    position: 'start',
                                    backgroundColor: 'rgba(241, 245, 249, 0.9)',
                                    color: '#475569',
                                    font: { size: 10 }
                                }
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        grid: { display: false },
                        ticks: { font: { weight: 'bold' }, color: '#475569' }
                    },
                    y: {
                        title: { display: true, text: 'Precio Promedio ($ MXN)', font: { weight: 'bold' }, color: '#581c87' },
                        ticks: {
                            callback: (val) => '$' + new Intl.NumberFormat('es-MX').format(val),
                            font: { weight: 'bold' },
                            color: '#581c87'
                        },
                        grid: { color: '#f3e8ff' }
                    }
                }
            }
        });

        function downloadImage() {
            const container = document.getElementById('report-container');
            html2canvas(container, {
                scale: 2,
                useCORS: true,
                backgroundColor: "#ffffff"
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'grafica_precios_oncologicos.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }
    </script>
</body>

</html>