<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evoluci√≥n Demogr√°fica de M√©xico (1960-2050)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js 4.x -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Plugin Datalabels -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
    <!-- Librer√≠a para capturar pantalla -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        /* Estilo para el slider */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 28px;
            width: 28px;
            border-radius: 50%;
            background: #4f46e5;
            cursor: pointer;
            margin-top: -12px;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            border: 2px solid white;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            cursor: pointer;
            background: #cbd5e1;
            border-radius: 3px;
        }
    </style>
</head>
<body class="bg-stone-50 min-h-screen flex flex-col items-center py-8 px-4">

    <!-- BARRA DE HERRAMIENTAS -->
    <div class="w-full max-w-6xl mb-6 flex flex-col sm:flex-row justify-between gap-3 no-print">
        
        <!-- BOT√ìN NAVEGACI√ìN -->
        <a href="https://araujome.github.io/visualizaciones/" class="flex items-center justify-center px-6 py-3 bg-white text-indigo-600 rounded-full shadow-sm hover:shadow-md border border-indigo-100 font-bold transition-all transform hover:scale-105">
            <i class="fa-solid fa-arrow-left mr-2"></i> M√°s Estudios
        </a>

        <!-- BOT√ìN DESCARGA -->
        <button onclick="downloadImage()" class="flex items-center justify-center px-6 py-3 bg-indigo-600 text-white rounded-full shadow-lg hover:bg-indigo-700 font-bold transition-all transform hover:scale-105">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
            Descargar Gr√°fica
        </button>
    </div>

    <!-- CONTENEDOR PRINCIPAL -->
    <div id="dashboard-container" class="w-full max-w-6xl bg-white rounded-3xl shadow-2xl overflow-hidden border border-stone-200">
        
        <!-- HEADER -->
        <div class="bg-slate-900 p-8 md:p-12 text-center relative overflow-hidden">
            <div class="relative z-10">
                <p class="text-indigo-400 font-bold text-sm uppercase tracking-[0.2em] mb-2">@SocioNomicsLab</p>
                <h1 class="text-4xl md:text-6xl font-black text-white mb-4 tracking-tight">
                    La Metamorfosis de M√©xico
                </h1>
                <p class="text-slate-300 text-xl font-light mb-8">
                    Evoluci√≥n de la estructura poblacional (1960 - 2050)
                </p>

                <!-- √çCONOS SOCIALES -->
                <div class="flex justify-center gap-8">
                    <a href="https://github.com/araujome" target="_blank" class="text-slate-400 hover:text-white hover:scale-110 transition-all duration-300">
                        <i class="fab fa-github text-3xl"></i>
                    </a>
                    <a href="https://www.linkedin.com/in/ericaraujom/" target="_blank" class="text-slate-400 hover:text-white hover:scale-110 transition-all duration-300">
                        <i class="fab fa-linkedin-in text-3xl"></i>
                    </a>
                    <a href="https://x.com/SocioNomicsLab" target="_blank" class="text-slate-400 hover:text-white hover:scale-110 transition-all duration-300">
                        <i class="fab fa-x-twitter text-3xl"></i>
                    </a>
                </div>
            </div>
            <div class="absolute top-0 right-0 w-96 h-96 bg-indigo-600 rounded-full mix-blend-overlay filter blur-[100px] opacity-30 transform translate-x-1/2 -translate-y-1/2"></div>
        </div>

        <div class="p-6 md:p-12">
            
            <!-- CONTROL DE TIEMPO (SLIDER) -->
            <div class="mb-12 px-4 max-w-4xl mx-auto">
                <div class="flex justify-between text-sm font-bold text-slate-400 mb-4 uppercase tracking-wider">
                    <span>1960</span>
                    <span>1990</span>
                    <span>2005</span>
                    <span>2020</span>
                    <span>2050</span>
                </div>
                <input type="range" id="yearSlider" min="0" max="12" value="9" step="1" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                <div class="text-center mt-6">
                    <span id="yearDisplay" class="text-6xl font-black text-indigo-700 tracking-tighter">2020</span>
                    <div class="mt-2">
                        <span id="dataTypeLabel" class="text-xs font-bold uppercase tracking-widest px-3 py-1 rounded-full bg-emerald-100 text-emerald-700">Dato Censal</span>
                    </div>
                </div>
            </div>

            <!-- CONTENEDOR DE GR√ÅFICA Y AN√ÅLISIS -->
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-12">
                
                <!-- COLUMNA IZQUIERDA: AN√ÅLISIS DIN√ÅMICO (35%) -->
                <div class="lg:col-span-4 flex flex-col justify-center space-y-6">
                    <!-- Caja de Texto -->
                    <div id="analysisBox" class="bg-indigo-50 p-8 rounded-3xl border-l-8 border-indigo-500 shadow-sm transition-all duration-500">
                        <h3 id="analysisTitle" class="text-2xl font-black text-indigo-900 mb-4 leading-tight">Madurez Poblacional</h3>
                        <p id="analysisText" class="text-base text-slate-700 leading-relaxed font-medium">
                            M√©xico alcanza 126.0M de habitantes. La base de la pir√°mide se contrae mientras crece la poblaci√≥n en edad productiva.
                        </p>
                        <div class="mt-4 pt-4 border-t border-indigo-200">
                            <p class="text-xs text-indigo-500 font-bold uppercase">Tasa de Fecundidad</p>
                            <p id="fertilityText" class="text-lg font-black text-indigo-900">Baja (1.9 hijos)</p>
                        </div>
                        <div class="mt-3 text-xs text-slate-500 italic" id="sourceText">
                            Fuente: Censo INEGI 2020
                        </div>
                    </div>

                    <!-- Caja de Indicadores -->
                    <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm grid grid-cols-2 gap-4">
                        <div>
                            <p class="text-[10px] text-slate-400 font-bold uppercase">Tasa de Dependencia</p>
                            <p class="text-2xl font-black text-slate-800" id="dependencyText">50.3%</p>
                            <p class="text-[9px] text-slate-400 italic">Dependientes por cada 100 productivos</p>
                        </div>
                        <div>
                            <p class="text-[10px] text-slate-400 font-bold uppercase">Poblaci√≥n 65+</p>
                            <p class="text-2xl font-black text-indigo-600" id="agingText">7.6%</p>
                            <p class="text-[9px] text-slate-400 italic">Nivel de envejecimiento</p>
                        </div>
                    </div>
                </div>

                <!-- COLUMNA DERECHA: PIR√ÅMIDE (65%) -->
                <div class="lg:col-span-8 flex flex-col gap-6">
                    <div class="relative h-[600px] bg-white rounded-2xl">
                        <canvas id="pyramidChart"></canvas>
                    </div>

                    <!-- PANEL DE TOTALES DIN√ÅMICOS -->
                    <div class="bg-white rounded-2xl border border-slate-200 p-6 flex flex-col md:flex-row justify-between items-center shadow-sm gap-4">
                        <div class="text-center md:text-left">
                            <p class="text-xs text-slate-400 font-bold uppercase tracking-widest mb-1" id="popLabel">Poblaci√≥n Censada</p>
                            <p class="text-4xl font-black text-slate-800" id="totalPop">126.0 M</p>
                        </div>
                        
                        <div class="flex gap-8">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-indigo-50 flex items-center justify-center text-indigo-600 font-bold border border-indigo-100">H</div>
                                <div>
                                    <p class="text-[10px] text-indigo-400 font-bold uppercase">Hombres</p>
                                    <p class="text-lg font-bold text-indigo-700" id="malePop">61.5 M</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-rose-50 flex items-center justify-center text-rose-600 font-bold border border-rose-100">M</div>
                                <div>
                                    <p class="text-[10px] text-rose-400 font-bold uppercase">Mujeres</p>
                                    <p class="text-lg font-bold text-rose-700" id="femalePop">64.5 M</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- SECCI√ìN DE METODOLOG√çA (Texto Completo) -->
        <div class="bg-stone-50 px-8 py-10 md:px-12 md:py-12 border-t border-stone-200">
            <div class="max-w-4xl mx-auto space-y-8">
                
                <div>
                    <h3 class="text-2xl font-bold text-slate-800 mb-3 border-l-4 border-indigo-500 pl-4">Nota Metodol√≥gica</h3>
                    <p class="text-sm md:text-base text-slate-600 leading-relaxed text-justify mb-4">
                        La visualizaci√≥n reconstruye la estructura demogr√°fica utilizando datos oficiales de los <strong>Censos de Poblaci√≥n y Vivienda</strong>, <strong>Conteos Intercensales</strong> y <strong>Encuestas</strong> del INEGI. Se segment√≥ la poblaci√≥n en grupos quinquenales de edad por sexo. Los valores negativos en el eje de hombres son con fines de representaci√≥n visual ("efecto espejo"). Las proyecciones 2030-2050 provienen del <strong>escenario medio de CONAPO (Proyecciones 2016-2050)</strong>.
                    </p>
                    <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded-r-lg">
                        <p class="text-sm font-bold text-blue-900 mb-2">üìä ¬øQu√© es la Tasa de Dependencia?</p>
                        <p class="text-sm text-blue-800 leading-relaxed">
                            Es un indicador que mide cu√°ntas personas <strong>dependientes</strong> (menores de 15 a√±os y mayores de 65 a√±os) hay por cada 100 personas en <strong>edad productiva</strong> (15-64 a√±os). Una tasa baja indica que hay m√°s poblaci√≥n en edad de trabajar, lo cual es favorable econ√≥micamente (bono demogr√°fico). Una tasa alta sugiere mayor presi√≥n sobre el sistema de pensiones, educaci√≥n y salud.
                        </p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-xl font-bold text-slate-800 mb-3 border-l-4 border-emerald-500 pl-4">Datos Hist√≥ricos INEGI</h3>
                        <ul class="list-none text-sm md:text-base text-slate-600 space-y-2">
                            <li><span class="font-bold text-emerald-600">‚ñ†</span> <strong>1960:</strong> 34.9 Millones (Censo)</li>
                            <li><span class="font-bold text-emerald-600">‚ñ†</span> <strong>1970:</strong> 48.2 Millones (Censo)</li>
                            <li><span class="font-bold text-emerald-600">‚ñ†</span> <strong>1980:</strong> 66.8 Millones (Censo)</li>
                            <li><span class="font-bold text-emerald-600">‚ñ†</span> <strong>1990:</strong> 81.2 Millones (Censo)</li>
                            <li><span class="font-bold text-blue-600">‚ñ†</span> <strong>1995:</strong> 91.2 Millones (Conteo)</li>
                            <li><span class="font-bold text-emerald-600">‚ñ†</span> <strong>2000:</strong> 97.5 Millones (Censo)</li>
                            <li><span class="font-bold text-blue-600">‚ñ†</span> <strong>2005:</strong> 103.3 Millones (Conteo)</li>
                            <li><span class="font-bold text-emerald-600">‚ñ†</span> <strong>2010:</strong> 112.3 Millones (Censo)</li>
                            <li><span class="font-bold text-blue-600">‚ñ†</span> <strong>2015:</strong> 119.5 Millones (Encuesta)</li>
                            <li><span class="font-bold text-emerald-600">‚ñ†</span> <strong>2020:</strong> 126.0 Millones (Censo)</li>
                        </ul>
                        <p class="text-xs text-slate-500 mt-3 italic">
                            <span class="text-emerald-600">‚ñ†</span> Censos completos &nbsp;
                            <span class="text-blue-600">‚ñ†</span> Conteos/Encuestas
                        </p>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-slate-800 mb-3 border-l-4 border-orange-500 pl-4">Proyecciones CONAPO</h3>
                        <p class="text-sm md:text-base text-slate-600 leading-relaxed text-justify mb-4">
                            Las proyecciones 2030-2050 se basan en el <strong>escenario medio</strong> de las "Proyecciones de la Poblaci√≥n de M√©xico 2016-2050" de CONAPO. Este escenario prev√© que M√©xico alcanzar√° <strong>138 millones de habitantes en 2030</strong> y aproximadamente <strong>148 millones en 2050</strong>, con un crecimiento del 0.1% anual hacia mediados de siglo.
                        </p>
                        <ul class="list-none text-sm text-slate-600 space-y-2">
                            <li><span class="font-bold text-orange-600">‚ñ†</span> <strong>2030:</strong> ~138 Millones (proyecci√≥n)</li>
                            <li><span class="font-bold text-orange-600">‚ñ†</span> <strong>2040:</strong> ~145 Millones (proyecci√≥n)</li>
                            <li><span class="font-bold text-orange-600">‚ñ†</span> <strong>2050:</strong> ~148 Millones (proyecci√≥n)</li>
                        </ul>
                    </div>
                </div>

                <div>
                    <h3 class="text-xl font-bold text-slate-800 mb-3 border-l-4 border-slate-500 pl-4">Bibliograf√≠a</h3>
                    <div class="bg-white p-4 rounded-lg border border-stone-200 text-xs text-slate-500 font-mono space-y-2">
                        <p class="pl-4 -indent-4">Instituto Nacional de Estad√≠stica y Geograf√≠a (INEGI). (1960-2020). <em>Censos de Poblaci√≥n y Vivienda</em>. M√©xico.</p>
                        <p class="pl-4 -indent-4">Instituto Nacional de Estad√≠stica y Geograf√≠a (INEGI). (1995, 2005). <em>Conteos de Poblaci√≥n y Vivienda</em>. M√©xico.</p>
                        <p class="pl-4 -indent-4">Instituto Nacional de Estad√≠stica y Geograf√≠a (INEGI). (2015). <em>Encuesta Intercensal 2015</em>. M√©xico.</p>
                        <p class="pl-4 -indent-4">Consejo Nacional de Poblaci√≥n (CONAPO). (2016). <em>Proyecciones de la Poblaci√≥n de M√©xico 2016-2050</em>. M√©xico: SEGOB.</p>
                        <p class="pl-4 -indent-4">Consejo Nacional de Poblaci√≥n (CONAPO). (2023). <em>Conciliaci√≥n Demogr√°fica de M√©xico 1950-2019 y Proyecciones 2020-2070</em>. M√©xico: SEGOB.</p>
                    </div>
                </div>

            </div>
        </div>

        <!-- FOOTER / LICENCIAS -->
        <div class="bg-white px-8 py-6 border-t border-stone-200">
            <div class="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center gap-6">
                
                <!-- Tarjeta de Licencia -->
                <div class="flex items-center gap-4 bg-stone-50 p-3 pr-5 rounded-xl border border-stone-200 shadow-sm">
                    <div class="p-2 bg-white rounded-lg text-slate-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-[10px] uppercase font-bold text-slate-400 leading-none mb-1">Licencia de uso</span>
                        <div class="flex items-center gap-3">
                            <a href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank" class="opacity-80 hover:opacity-100 transition-opacity">
                                <img alt="CC BY-NC 4.0" style="border-width:0" src="https://licensebuttons.net/l/by-nc/4.0/80x15.png" onerror="this.style.display='none'"/>
                            </a>
                            <span class="text-slate-300 text-xs">|</span>
                            <a href="https://opensource.org/license/MIT" target="_blank" class="text-xs font-bold text-indigo-600 hover:text-indigo-800 flex items-center gap-1 group transition-colors">
                                MIT License
                                <svg class="w-3 h-3 group-hover:translate-x-0.5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                            </a>
                        </div>
                    </div>
                </div>

                <div class="text-right">
                    <p class="text-[10px] text-slate-400 uppercase font-bold mb-1">An√°lisis y Dise√±o</p>
                    <p class="text-sm font-bold text-slate-700">Eric Araujo Mart√≠nez <span class="text-indigo-500">(@SocioNomicsLab)</span></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATOS DEMOGR√ÅFICOS CORREGIDOS CON FUENTES OFICIALES ---
            const ageGroups = ['85+', '80‚Äì84', '75‚Äì79', '70‚Äì74', '65‚Äì69', '60‚Äì64', '55‚Äì59', '50‚Äì54', '45‚Äì49', '40‚Äì44', '35‚Äì39', '30‚Äì34', '25‚Äì29', '20‚Äì24', '15‚Äì19', '10‚Äì14', '5‚Äì9', '0‚Äì4'];

            const database = [
                {
                    year: 1960,
                    title: "La Explosi√≥n Demogr√°fica",
                    desc: "M√©xico es un pa√≠s de ni√±os (34.9M habitantes seg√∫n censo oficial). La tasa de fecundidad es muy alta y la esperanza de vida limitada.",
                    fertility: "Muy Alta (6.8 hijos/mujer)",
                    source: "Censo de Poblaci√≥n INEGI 1960",
                    dataType: "censal",
                    // Total Oficial INEGI: 34,923,129 habitantes ‚âà 34.9M
                    male: [-0.036, -0.066, -0.11, -0.161, -0.234, -0.308, -0.454, -0.601, -0.747, -0.894, -1.012, -1.158, -1.26, -1.392, -1.648, -1.941, -2.309, -2.711],
                    female: [0.044, 0.08, 0.125, 0.183, 0.278, 0.352, 0.498, 0.645, 0.791, 0.938, 1.063, 1.187, 1.304, 1.503, 1.722, 2.015, 2.382, 2.749]
                },
                {
                    year: 1970,
                    title: "Juventud Predominante",
                    desc: "Poblaci√≥n de 48.2M. El crecimiento sigue siendo alto (3.4% anual) con mejoras en salud p√∫blica y reducci√≥n de la mortalidad infantil.",
                    fertility: "Alta (6.5 hijos/mujer)",
                    source: "Censo de Poblaci√≥n INEGI 1970",
                    dataType: "censal",
                    // Total Oficial: 48,225,238 habitantes
                    male: [-0.06, -0.098, -0.15, -0.226, -0.339, -0.451, -0.602, -0.752, -0.94, -1.091, -1.279, -1.429, -1.655, -1.956, -2.332, -2.859, -3.385, -3.912],
                    female: [0.075, 0.12, 0.188, 0.263, 0.391, 0.512, 0.639, 0.828, 0.978, 1.166, 1.354, 1.505, 1.768, 2.069, 2.445, 2.934, 3.461, 3.987]
                },
                {
                    year: 1980,
                    title: "Inicio de la Planificaci√≥n",
                    desc: "Poblaci√≥n de 66.8M. Comienzan las campa√±as gubernamentales de planificaci√≥n familiar ('La familia peque√±a vive mejor').",
                    fertility: "Descendiendo (4.5 hijos/mujer)",
                    source: "Censo de Poblaci√≥n INEGI 1980",
                    dataType: "censal",
                    // Total Oficial: 66,846,833 habitantes
                    male: [-0.1, -0.146, -0.213, -0.319, -0.432, -0.598, -0.797, -0.996, -1.229, -1.495, -1.76, -2.059, -2.458, -2.923, -3.454, -4.052, -4.65, -5.181],
                    female: [0.12, 0.186, 0.252, 0.365, 0.498, 0.664, 0.864, 1.063, 1.295, 1.561, 1.827, 2.126, 2.524, 2.989, 3.521, 4.119, 4.716, 5.248]
                },
                {
                    year: 1990,
                    title: "Transici√≥n Demogr√°fica",
                    desc: "Poblaci√≥n de 81.2M. La pir√°mide muestra estabilizaci√≥n en la base. M√©xico entra en la fase de transici√≥n demogr√°fica avanzada.",
                    fertility: "Moderada (3.4 hijos/mujer)",
                    source: "Censo de Poblaci√≥n INEGI 1990",
                    dataType: "censal",
                    // Total Oficial: 81,249,645 habitantes
                    male: [-0.149, -0.203, -0.305, -0.44, -0.576, -0.779, -1.016, -1.287, -1.592, -1.965, -2.372, -2.778, -3.253, -3.727, -4.269, -4.743, -5.15, -5.353],
                    female: [0.19, 0.257, 0.373, 0.508, 0.678, 0.881, 1.084, 1.355, 1.694, 2.033, 2.439, 2.846, 3.32, 3.795, 4.337, 4.811, 5.218, 5.421]
                },
                {
                    year: 1995,
                    title: "Primer Conteo Intercensal",
                    desc: "Poblaci√≥n de 91.2M. Primera actualizaci√≥n censal entre d√©cadas para mejorar la planeaci√≥n. La fecundidad contin√∫a descendiendo.",
                    fertility: "En descenso (2.8 hijos/mujer)",
                    source: "Conteo de Poblaci√≥n INEGI 1995",
                    dataType: "intercensal",
                    // Total Estimado: ~91,158,290 habitantes
                    male: [-0.18, -0.252, -0.36, -0.518, -0.705, -0.935, -1.222, -1.546, -1.927, -2.337, -2.79, -3.25, -3.739, -4.228, -4.71, -5.119, -5.429, -5.623],
                    female: [0.237, 0.324, 0.453, 0.597, 0.812, 1.043, 1.309, 1.639, 2.013, 2.43, 2.876, 3.322, 3.811, 4.3, 4.781, 5.191, 5.5, 5.695]
                },
                {
                    year: 2000,
                    title: "El Bono Demogr√°fico (Inicio)",
                    desc: "Poblaci√≥n de 97.5M. Reducci√≥n notable de nacimientos. La poblaci√≥n en edad productiva alcanza su m√°ximo hist√≥rico relativo.",
                    fertility: "Baja (2.6 hijos/mujer)",
                    source: "Censo de Poblaci√≥n INEGI 2000",
                    dataType: "censal",
                    // Total Oficial: 97,483,412 habitantes
                    male: [-0.217, -0.29, -0.42, -0.594, -0.833, -1.087, -1.413, -1.775, -2.21, -2.681, -3.152, -3.659, -4.166, -4.601, -4.963, -5.18, -5.325, -5.398],
                    female: [0.29, 0.377, 0.507, 0.688, 0.942, 1.195, 1.522, 1.884, 2.318, 2.789, 3.224, 3.731, 4.239, 4.673, 5.035, 5.253, 5.398, 5.47]
                },
                {
                    year: 2005,
                    title: "Segundo Conteo Intercensal",
                    desc: "Poblaci√≥n de 103.3M. Consolidaci√≥n del bono demogr√°fico. La estructura muestra un engrosamiento del centro de la pir√°mide.",
                    fertility: "Baja (2.2 hijos/mujer)",
                    source: "II Conteo de Poblaci√≥n INEGI 2005",
                    dataType: "intercensal",
                    // Total Estimado: ~103,263,388 habitantes
                    male: [-0.281, -0.37, -0.533, -0.725, -0.977, -1.273, -1.628, -2.035, -2.516, -3.034, -3.552, -4.033, -4.44, -4.772, -5.031, -5.179, -5.216, -5.165],
                    female: [0.37, 0.466, 0.651, 0.836, 1.11, 1.406, 1.761, 2.168, 2.649, 3.145, 3.626, 4.107, 4.514, 4.846, 5.105, 5.253, 5.29, 5.239]
                },
                {
                    year: 2010,
                    title: "Estabilizaci√≥n Demogr√°fica",
                    desc: "Poblaci√≥n de 112.3M. La pir√°mide toma forma de campana. La tasa de fecundidad se acerca al nivel de reemplazo poblacional.",
                    fertility: "Nivel de reemplazo (2.3 hijos/mujer)",
                    source: "Censo de Poblaci√≥n INEGI 2010",
                    dataType: "censal",
                    // Total Oficial: 112,336,538 habitantes
                    male: [-0.348, -0.465, -0.658, -0.89, -1.161, -1.51, -1.897, -2.361, -2.903, -3.484, -4.065, -4.529, -4.839, -5.071, -5.226, -5.303, -5.265, -5.187],
                    female: [0.465, 0.581, 0.774, 1.006, 1.316, 1.665, 2.052, 2.516, 3.058, 3.6, 4.142, 4.607, 4.916, 5.149, 5.303, 5.381, 5.342, 5.265]
                },
                {
                    year: 2015,
                    title: "Encuesta Intercensal",
                    desc: "Poblaci√≥n de 119.5M. M√©xico se acerca al pico demogr√°fico. El envejecimiento poblacional comienza a ser evidente.",
                    fertility: "Baja (2.1 hijos/mujer)",
                    source: "Encuesta Intercensal INEGI 2015",
                    dataType: "intercensal",
                    // Total Estimado: ~119,530,753 habitantes
                    male: [-0.457, -0.594, -0.822, -1.142, -1.534, -1.991, -2.466, -3.014, -3.607, -4.183, -4.521, -4.749, -4.886, -4.95, -4.932, -4.886, -4.749, -4.566],
                    female: [0.594, 0.731, 0.959, 1.324, 1.735, 2.192, 2.667, 3.215, 3.808, 4.384, 4.722, 4.95, 5.087, 5.151, 5.133, 5.087, 4.95, 4.767]
                },
                {
                    year: 2020,
                    title: "Madurez Poblacional",
                    desc: "Poblaci√≥n de 126.0M (Censo oficial). Base contra√≠da y aumento de adultos mayores. Finaliza el bono demogr√°fico.",
                    fertility: "Baja (1.9 hijos/mujer)",
                    source: "Censo de Poblaci√≥n INEGI 2020",
                    dataType: "censal",
                    // Total Oficial Exacto: 126,014,024 habitantes
                    male: [-0.525, -0.668, -0.906, -1.288, -1.765, -2.29, -2.815, -3.387, -3.96, -4.437, -4.723, -4.914, -5.009, -5.057, -5.057, -5.009, -4.866, -4.676],
                    female: [0.668, 0.811, 1.05, 1.479, 1.956, 2.481, 3.006, 3.578, 4.151, 4.628, 4.914, 5.105, 5.2, 5.248, 5.248, 5.2, 5.057, 4.866]
                },
                {
                    year: 2030,
                    title: "Envejecimiento Acelerado",
                    desc: "Proyecci√≥n CONAPO: 138M habitantes. La poblaci√≥n contin√∫a creciendo pero a ritmo muy reducido (0.6% anual). Inicia envejecimiento acelerado.",
                    fertility: "Muy baja (1.9 hijos/mujer)",
                    source: "Proyecci√≥n CONAPO 2016-2050 (Escenario Medio)",
                    dataType: "proyeccion",
                    // Proyecci√≥n Oficial CONAPO: 138,070,271 habitantes
                    male: [-0.80, -1.05, -1.45, -1.95, -2.55, -3.15, -3.75, -4.25, -4.75, -5.05, -5.25, -5.30, -5.25, -5.15, -5.00, -4.80, -4.60, -4.35],
                    female: [1.00, 1.30, 1.75, 2.30, 2.95, 3.55, 4.15, 4.65, 5.15, 5.45, 5.65, 5.70, 5.65, 5.55, 5.40, 5.20, 5.00, 4.75]
                },
                {
                    year: 2040,
                    title: "Estructura Madura",
                    desc: "Proyecci√≥n CONAPO: ~145M habitantes. M√©xico se acerca al pico poblacional hist√≥rico. La pir√°mide adquiere forma de urna.",
                    fertility: "Cr√≠tica (1.7 hijos/mujer)",
                    source: "Proyecci√≥n CONAPO 2016-2050 (Escenario Medio)",
                    dataType: "proyeccion",
                    // Proyecci√≥n basada en tendencias CONAPO ~145M
                    male: [-1.20, -1.55, -2.05, -2.65, -3.25, -3.85, -4.35, -4.85, -5.15, -5.35, -5.45, -5.45, -5.35, -5.20, -5.00, -4.75, -4.50, -4.20],
                    female: [1.50, 1.95, 2.50, 3.15, 3.75, 4.35, 4.85, 5.35, 5.65, 5.85, 5.95, 5.95, 5.85, 5.70, 5.50, 5.25, 4.95, 4.60]
                },
                {
                    year: 2050,
                    title: "Pir√°mide Invertida",
                    desc: "Proyecci√≥n CONAPO: 148.2M habitantes. Estabilizaci√≥n demogr√°fica y envejecimiento masivo. 1 de cada 4 mexicanos tendr√° m√°s de 60 a√±os.",
                    fertility: "Estancada (1.7 hijos/mujer)",
                    source: "Proyecci√≥n CONAPO 2016-2050 (Escenario Medio)",
                    dataType: "proyeccion",
                    // Proyecci√≥n Oficial CONAPO: 148,209,594 habitantes
                    male: [-1.80, -2.25, -2.85, -3.45, -4.05, -4.55, -4.95, -5.25, -5.45, -5.55, -5.55, -5.45, -5.30, -5.10, -4.85, -4.55, -4.25, -3.95],
                    female: [2.20, 2.75, 3.45, 4.05, 4.65, 5.15, 5.55, 5.85, 6.05, 6.15, 6.15, 6.05, 5.90, 5.70, 5.45, 5.15, 4.85, 4.55]
                }
            ];

            // --- CONFIGURACI√ìN DE CHART.JS ---
            const ctx = document.getElementById('pyramidChart').getContext('2d');
            const slider = document.getElementById('yearSlider');
            const yearDisplay = document.getElementById('yearDisplay');
            const analysisTitle = document.getElementById('analysisTitle');
            const analysisText = document.getElementById('analysisText');
            const fertilityText = document.getElementById('fertilityText');
            const sourceText = document.getElementById('sourceText');
            const analysisBox = document.getElementById('analysisBox');
            const popLabel = document.getElementById('popLabel');
            const dataTypeLabel = document.getElementById('dataTypeLabel');
            
            const totalPopDisplay = document.getElementById('totalPop');
            const malePopDisplay = document.getElementById('malePop');
            const femalePopDisplay = document.getElementById('femalePop');
            const dependencyText = document.getElementById('dependencyText');
            const agingText = document.getElementById('agingText');

            const chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ageGroups,
                    datasets: [
                        { 
                            label: 'Hombres', 
                            data: [], 
                            backgroundColor: '#4f46e5', 
                            borderRadius: { topLeft: 4, bottomLeft: 4 }, 
                            barPercentage: 0.9 
                        },
                        { 
                            label: 'Mujeres', 
                            data: [], 
                            backgroundColor: '#e11d48', 
                            borderRadius: { topRight: 4, bottomRight: 4 }, 
                            barPercentage: 0.9 
                        }
                    ]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: {
                        padding: {
                            left: 10,
                            right: 10,
                            top: 10,
                            bottom: 10
                        }
                    },
                    scales: {
                        x: { 
                            stacked: true, 
                            min: -8, 
                            max: 8, 
                            grid: { color: '#f1f5f9' }, 
                            ticks: { 
                                callback: v => Math.abs(v) + 'M', 
                                font: { family: 'Inter', weight: 'bold' } 
                            } 
                        },
                        y: { 
                            stacked: true, 
                            grid: { display: false }, 
                            ticks: { 
                                font: { family: 'Inter', size: 11, weight: 'bold' },
                                padding: 5
                            }, 
                            reverse: false 
                        }
                    },
                    plugins: {
                        legend: { 
                            position: 'top',
                            labels: {
                                font: { family: 'Inter', size: 13, weight: 'bold' }
                            }
                        },
                        tooltip: { 
                            callbacks: { 
                                label: ctx => ctx.dataset.label + ': ' + Math.abs(ctx.raw).toFixed(1) + ' Millones' 
                            } 
                        }
                    }
                }
            });

            function updateDashboard(index) {
                if (!database[index]) return;
                const data = database[index];
                
                // Actualizar textos
                if (yearDisplay) yearDisplay.textContent = data.year;
                if (analysisTitle) analysisTitle.textContent = data.title;
                if (analysisText) analysisText.textContent = data.desc;
                if (fertilityText) fertilityText.textContent = data.fertility;
                if (sourceText) sourceText.textContent = 'Fuente: ' + data.source;
                
                // Actualizar etiqueta seg√∫n tipo de dato
                if (popLabel && dataTypeLabel) {
                    if (data.dataType === 'censal') {
                        popLabel.textContent = 'Poblaci√≥n Censada';
                        dataTypeLabel.textContent = 'Dato Censal';
                        dataTypeLabel.className = 'text-xs font-bold uppercase tracking-widest px-3 py-1 rounded-full bg-emerald-100 text-emerald-700';
                    } else if (data.dataType === 'intercensal') {
                        popLabel.textContent = 'Poblaci√≥n Registrada';
                        dataTypeLabel.textContent = 'Conteo/Encuesta';
                        dataTypeLabel.className = 'text-xs font-bold uppercase tracking-widest px-3 py-1 rounded-full bg-blue-100 text-blue-700';
                    } else {
                        popLabel.textContent = 'Poblaci√≥n Proyectada';
                        dataTypeLabel.textContent = 'Proyecci√≥n CONAPO';
                        dataTypeLabel.className = 'text-xs font-bold uppercase tracking-widest px-3 py-1 rounded-full bg-orange-100 text-orange-700';
                    }
                }

                // Animaci√≥n sutil
                if (analysisBox) {
                    analysisBox.classList.remove('border-indigo-500');
                    void analysisBox.offsetWidth;
                    analysisBox.classList.add('border-indigo-500');
                }

                // Actualizar gr√°fica
                chart.data.datasets[0].data = data.male;
                chart.data.datasets[1].data = data.female;
                chart.update();

                // C√°lculos demogr√°ficos
                const malesAbs = data.male.map(Math.abs);
                const femalesAbs = data.female;
                const totalPerGroup = malesAbs.map((num, idx) => num + femalesAbs[idx]);
                const totalPopulation = malesAbs.reduce((a, b) => a + b, 0) + femalesAbs.reduce((a, b) => a + b, 0);

                // Grupos de edad para indicadores
                const pop0to14 = totalPerGroup[15] + totalPerGroup[16] + totalPerGroup[17]; // 0-4, 5-9, 10-14
                const pop65plus = totalPerGroup[0] + totalPerGroup[1] + totalPerGroup[2] + totalPerGroup[3] + totalPerGroup[4]; // 65-69, 70-74, 75-79, 80-84, 85+
                const pop15to64 = totalPopulation - pop0to14 - pop65plus;

                // Actualizar displays
                if (totalPopDisplay) totalPopDisplay.textContent = totalPopulation.toFixed(1) + ' M';
                if (malePopDisplay) malePopDisplay.textContent = malesAbs.reduce((a, b) => a + b, 0).toFixed(1) + ' M';
                if (femalePopDisplay) femalePopDisplay.textContent = femalesAbs.reduce((a, b) => a + b, 0).toFixed(1) + ' M';
                if (dependencyText) dependencyText.textContent = ((pop0to14 + pop65plus) / pop15to64 * 100).toFixed(1) + '%';
                if (agingText) agingText.textContent = (pop65plus / totalPopulation * 100).toFixed(1) + '%';
            }

            // Event listeners
            if (slider) slider.addEventListener('input', (e) => updateDashboard(e.target.value));
            
            // Inicializar en 2020 (√≠ndice 9)
            updateDashboard(9);
        });

        function downloadImage() {
            const container = document.getElementById('dashboard-container');
            if (!container) return;
            html2canvas(container, { 
                scale: 2, 
                useCORS: true, 
                backgroundColor: "#ffffff" 
            }).then(canvas => {
                const year = document.getElementById('yearDisplay').textContent;
                const link = document.createElement('a');
                link.download = `piramide_poblacion_mexico_${year}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }
    </script>
</body>
</html>
