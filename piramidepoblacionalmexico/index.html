<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evolución Demográfica de México (1960-2050)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js 4.x -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Plugin Datalabels -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
    <!-- Librería para capturar pantalla -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        /* Estilo para el slider */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 28px;
            width: 28px;
            border-radius: 50%;
            background: #4f46e5;
            cursor: pointer;
            margin-top: -12px;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            border: 2px solid white;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            cursor: pointer;
            background: #cbd5e1;
            border-radius: 3px;
        }
    </style>
</head>
<body class="bg-stone-50 min-h-screen flex flex-col items-center py-8 px-4">

    <!-- BARRA DE HERRAMIENTAS -->
    <div class="w-full max-w-6xl mb-6 flex flex-col sm:flex-row justify-between gap-3 no-print">
        
        <!-- BOTÓN NAVEGACIÓN -->
        <a href="https://araujome.github.io/visualizaciones/" class="flex items-center justify-center px-6 py-3 bg-white text-indigo-600 rounded-full shadow-sm hover:shadow-md border border-indigo-100 font-bold transition-all transform hover:scale-105">
            <i class="fa-solid fa-arrow-left mr-2"></i> Más Estudios
        </a>

        <!-- BOTÓN DESCARGA -->
        <button onclick="downloadImage()" class="flex items-center justify-center px-6 py-3 bg-indigo-600 text-white rounded-full shadow-lg hover:bg-indigo-700 font-bold transition-all transform hover:scale-105">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
            Descargar Gráfica
        </button>
    </div>

    <!-- CONTENEDOR PRINCIPAL -->
    <div id="dashboard-container" class="w-full max-w-6xl bg-white rounded-3xl shadow-2xl overflow-hidden border border-stone-200">
        
        <!-- HEADER -->
        <div class="bg-slate-900 p-8 md:p-12 text-center relative overflow-hidden">
            <div class="relative z-10">
                <p class="text-indigo-400 font-bold text-sm uppercase tracking-[0.2em] mb-2">@SocioNomicsLab</p>
                <h1 class="text-4xl md:text-6xl font-black text-white mb-4 tracking-tight">
                    La Metamorfosis de México
                </h1>
                <p class="text-slate-300 text-xl font-light mb-8">
                    Evolución de la estructura poblacional (1960 - 2050)
                </p>

                <!-- ÍCONOS SOCIALES -->
                <div class="flex justify-center gap-8">
                    <a href="https://github.com/araujome" target="_blank" class="text-slate-400 hover:text-white hover:scale-110 transition-all duration-300">
                        <i class="fab fa-github text-3xl"></i>
                    </a>
                    <a href="https://www.linkedin.com/in/ericaraujom/" target="_blank" class="text-slate-400 hover:text-white hover:scale-110 transition-all duration-300">
                        <i class="fab fa-linkedin-in text-3xl"></i>
                    </a>
                    <a href="https://x.com/SocioNomicsLab" target="_blank" class="text-slate-400 hover:text-white hover:scale-110 transition-all duration-300">
                        <i class="fab fa-x-twitter text-3xl"></i>
                    </a>
                </div>
            </div>
            <div class="absolute top-0 right-0 w-96 h-96 bg-indigo-600 rounded-full mix-blend-overlay filter blur-[100px] opacity-30 transform translate-x-1/2 -translate-y-1/2"></div>
        </div>

        <div class="p-6 md:p-12">
            
            <!-- CONTROL DE TIEMPO (SLIDER) -->
            <div class="mb-12 px-4 max-w-4xl mx-auto">
                <div class="flex justify-between text-sm font-bold text-slate-400 mb-4 uppercase tracking-wider">
                    <span>1960</span>
                    <span>1980</span>
                    <span>2000</span>
                    <span>2020</span>
                    <span>2040</span>
                </div>
                <input type="range" id="yearSlider" min="0" max="9" value="6" step="1" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                <div class="text-center mt-6">
                    <span id="yearDisplay" class="text-6xl font-black text-indigo-700 tracking-tighter">2020</span>
                </div>
            </div>

            <!-- CONTENEDOR DE GRÁFICA Y ANÁLISIS -->
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-12">
                
                <!-- COLUMNA IZQUIERDA: ANÁLISIS DINÁMICO (35%) -->
                <div class="lg:col-span-4 flex flex-col justify-center space-y-6">
                    <!-- Caja de Texto -->
                    <div id="analysisBox" class="bg-indigo-50 p-8 rounded-3xl border-l-8 border-indigo-500 shadow-sm transition-all duration-500">
                        <h3 id="analysisTitle" class="text-2xl font-black text-indigo-900 mb-4 leading-tight">El Bono Demográfico</h3>
                        <p id="analysisText" class="text-base text-slate-700 leading-relaxed font-medium">
                            La base de la pirámide comienza a estrecharse. Hay menos niños que en décadas anteriores, pero la población en edad laboral (15-64 años) es la más grande de la historia.
                        </p>
                    </div>

                    <!-- Caja de Indicadores -->
                    <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm grid grid-cols-2 gap-4">
                        <div>
                            <p class="text-[10px] text-slate-400 font-bold uppercase">Tasa de Dependencia</p>
                            <p class="text-2xl font-black text-slate-800" id="dependencyText">50.3%</p>
                            <p class="text-[9px] text-slate-400 italic">Dependientes por cada 100 productivos</p>
                        </div>
                        <div>
                            <p class="text-[10px] text-slate-400 font-bold uppercase">Población 65+</p>
                            <p class="text-2xl font-black text-indigo-600" id="agingText">7.6%</p>
                            <p class="text-[9px] text-slate-400 italic">Nivel de envejecimiento</p>
                        </div>
                    </div>
                </div>

                <!-- COLUMNA DERECHA: PIRÁMIDE (65%) -->
                <div class="lg:col-span-8 flex flex-col gap-6">
                    <div class="relative h-[600px] bg-white rounded-2xl">
                        <canvas id="pyramidChart"></canvas>
                    </div>

                    <!-- PANEL DE TOTALES DINÁMICOS -->
                    <div class="bg-white rounded-2xl border border-slate-200 p-6 flex flex-col md:flex-row justify-between items-center shadow-sm gap-4">
                        <div class="text-center md:text-left">
                            <p class="text-xs text-slate-400 font-bold uppercase tracking-widest mb-1" id="popLabel">Población Censada</p>
                            <p class="text-4xl font-black text-slate-800" id="totalPop">126.0 M</p>
                        </div>
                        
                        <div class="flex gap-8">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-indigo-50 flex items-center justify-center text-indigo-600 font-bold border border-indigo-100">H</div>
                                <div>
                                    <p class="text-[10px] text-indigo-400 font-bold uppercase">Hombres</p>
                                    <p class="text-lg font-bold text-indigo-700" id="malePop">61.5 M</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-rose-50 flex items-center justify-center text-rose-600 font-bold border border-rose-100">M</div>
                                <div>
                                    <p class="text-[10px] text-rose-400 font-bold uppercase">Mujeres</p>
                                    <p class="text-lg font-bold text-rose-700" id="femalePop">64.5 M</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- SECCIÓN DE METODOLOGÍA (Texto Completo) -->
        <div class="bg-stone-50 px-8 py-10 md:px-12 md:py-12 border-t border-stone-200">
            <div class="max-w-4xl mx-auto space-y-8">
                
                <div>
                    <h3 class="text-2xl font-bold text-slate-800 mb-3 border-l-4 border-indigo-500 pl-4">Nota Metodológica</h3>
                    <div class="bg-yellow-50 border border-yellow-200 p-4 rounded-lg mb-4">
                        <p class="text-xs text-yellow-800 font-semibold">⚠️ Precisión de los Datos:</p>
                        <p class="text-xs text-yellow-800 mt-1">
                            Los datos de 1960 a 2020 se han calibrado para coincidir con los <strong>totales oficiales de los Censos de Población y Vivienda</strong> (1960: 36.7M, 2020: 126M). Para las proyecciones (2030-2050), se considera la tendencia inercial de CONAPO, tomando como referencia una población estimada de 133.4M para 2025.
                        </p>
                    </div>
                    <p class="text-sm md:text-base text-slate-600 leading-relaxed text-justify">
                        La visualización reconstruye la estructura demográfica utilizando datos de los Censos de Población y Vivienda del INEGI. Se segmentó la población en grupos quinquenales de edad. Los valores negativos en el eje de hombres son con fines de representación visual ("efecto espejo").
                    </p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-xl font-bold text-slate-800 mb-3 border-l-4 border-emerald-500 pl-4">Datos Históricos (Censos INEGI)</h3>
                        <ul class="list-disc list-inside text-sm md:text-base text-slate-600 space-y-2">
                            <li><strong>1960:</strong> 36.7 Millones</li>
                            <li><strong>1970:</strong> 48.2 Millones</li>
                            <li><strong>1990:</strong> 81.2 Millones</li>
                            <li><strong>2010:</strong> 112.3 Millones</li>
                            <li><strong>2020:</strong> 126.0 Millones</li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-slate-800 mb-3 border-l-4 border-orange-500 pl-4">Análisis</h3>
                        <p class="text-sm md:text-base text-slate-600 leading-relaxed text-justify">
                            México ha cuadruplicado su población en los últimos 60 años, pasando de una estructura piramidal expansiva a una en forma de campana. La proyección para 2025 alcanza los 133.4 millones, marcando la etapa madura del bono demográfico antes del inicio del envejecimiento acelerado hacia 2050.
                        </p>
                    </div>
                </div>

                <div>
                    <h3 class="text-xl font-bold text-slate-800 mb-3 border-l-4 border-slate-500 pl-4">Bibliografía</h3>
                    <div class="bg-white p-4 rounded-lg border border-stone-200 text-xs text-slate-500 font-mono space-y-2">
                        <p class="pl-4 -indent-4">Instituto Nacional de Estadística y Geografía (INEGI). (1960-2020). <em>Censos de Población y Vivienda (Tabulados Básicos)</em>.</p>
                        <p class="pl-4 -indent-4">Consejo Nacional de Población (CONAPO). (2023). <em>Proyecciones de la Población de México 2020-2070</em>.</p>
                    </div>
                </div>

            </div>
        </div>

        <!-- FOOTER / LICENCIAS -->
        <div class="bg-white px-8 py-6 border-t border-stone-200">
            <div class="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center gap-6">
                
                <!-- Tarjeta de Licencia -->
                <div class="flex items-center gap-4 bg-stone-50 p-3 pr-5 rounded-xl border border-stone-200 shadow-sm">
                    <div class="p-2 bg-white rounded-lg text-slate-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-[10px] uppercase font-bold text-slate-400 leading-none mb-1">Licencia de uso</span>
                        <div class="flex items-center gap-3">
                            <a href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank" class="opacity-80 hover:opacity-100 transition-opacity">
                                <img alt="CC BY-NC 4.0" style="border-width:0" src="https://licensebuttons.net/l/by-nc/4.0/80x15.png" onerror="this.style.display='none'"/>
                            </a>
                            <span class="text-slate-300 text-xs">|</span>
                            <a href="https://opensource.org/license/MIT" target="_blank" class="text-xs font-bold text-indigo-600 hover:text-indigo-800 flex items-center gap-1 group transition-colors">
                                MIT License
                                <svg class="w-3 h-3 group-hover:translate-x-0.5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                            </a>
                        </div>
                    </div>
                </div>

                <div class="text-right">
                    <p class="text-[10px] text-slate-400 uppercase font-bold mb-1">Análisis y Diseño</p>
                    <p class="text-sm font-bold text-slate-700">Eric Araujo Martínez <span class="text-indigo-500">(@SocioNomicsLab)</span></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATOS DEMOGRÁFICOS RECALIBRADOS AL DETALLE CENSAL ---
            const ageGroups = ['85+', '80-84', '75-79', '70-74', '65-69', '60-64', '55-59', '50-54', '45-49', '40-44', '35-39', '30-34', '25-29', '20-24', '15-19', '10-14', '5-9', '0-4'];

            const database = [
                {
                    year: 1960,
                    title: "La Explosión Demográfica",
                    desc: "México es un país de niños (36.7M). La tasa de fecundidad es muy alta.",
                    fertility: "Muy Alta (6.8 hijos)",
                    // Total Recalibrado: 36.7M
                    male: [-0.05, -0.09, -0.15, -0.22, -0.32, -0.42, -0.62, -0.82, -1.02, -1.22, -1.38, -1.58, -1.72, -1.90, -2.25, -2.65, -3.15, -3.70],
                    female: [0.06, 0.11, 0.17, 0.25, 0.38, 0.48, 0.68, 0.88, 1.08, 1.28, 1.45, 1.62, 1.78, 2.05, 2.35, 2.75, 3.25, 3.75]
                },
                {
                    year: 1970,
                    title: "Juventud Predominante",
                    desc: "Población de 48.2M. El crecimiento sigue siendo alto con mejoras en salud.",
                    fertility: "Alta (6.5 hijos)",
                    // Total Recalibrado: 48.2M
                    male: [-0.08, -0.13, -0.20, -0.30, -0.45, -0.60, -0.80, -1.00, -1.25, -1.45, -1.70, -1.90, -2.20, -2.60, -3.10, -3.80, -4.50, -5.20],
                    female: [0.10, 0.16, 0.25, 0.35, 0.52, 0.68, 0.85, 1.10, 1.30, 1.55, 1.80, 2.00, 2.35, 2.75, 3.25, 3.90, 4.60, 5.30]
                },
                {
                    year: 1980,
                    title: "Inicio de la Planificación",
                    desc: "Población de 66.8M. Comienzan las campañas de planificación.",
                    fertility: "Descendiendo (4.5 hijos)",
                    // Total Recalibrado: 66.8M
                    male: [-0.15, -0.22, -0.32, -0.48, -0.65, -0.90, -1.20, -1.50, -1.85, -2.25, -2.65, -3.10, -3.70, -4.40, -5.20, -6.10, -7.00, -7.80],
                    female: [0.18, 0.28, 0.38, 0.55, 0.75, 1.00, 1.30, 1.60, 1.95, 2.35, 2.75, 3.20, 3.80, 4.50, 5.30, 6.20, 7.10, 7.90]
                },
                {
                    year: 1990,
                    title: "Transición Demográfica",
                    desc: "Población de 81.2M. Estabilización de la base.",
                    fertility: "Moderada (3.4 hijos)",
                    // Total Recalibrado: 81.2M
                    male: [-0.22, -0.30, -0.45, -0.65, -0.85, -1.15, -1.50, -1.90, -2.35, -2.90, -3.50, -4.10, -4.80, -5.50, -6.30, -7.00, -7.60, -7.90],
                    female: [0.28, 0.38, 0.55, 0.75, 1.00, 1.30, 1.60, 2.00, 2.50, 3.00, 3.60, 4.20, 4.90, 5.60, 6.40, 7.10, 7.70, 8.00]
                },
                {
                    year: 2000,
                    title: "El Bono Demográfico (Inicio)",
                    desc: "Población de 97.5M. Reducción notable de nacimientos.",
                    fertility: "Baja (2.6 hijos)",
                    // Total Recalibrado: 97.5M
                    male: [-0.30, -0.40, -0.58, -0.82, -1.15, -1.50, -1.95, -2.45, -3.05, -3.70, -4.35, -5.05, -5.75, -6.35, -6.85, -7.15, -7.35, -7.45],
                    female: [0.40, 0.52, 0.70, 0.95, 1.30, 1.65, 2.10, 2.60, 3.20, 3.85, 4.45, 5.15, 5.85, 6.45, 6.95, 7.25, 7.45, 7.55]
                },
                {
                    year: 2010,
                    title: "Estabilización",
                    desc: "Población de 112.3M. Engrosamiento del centro de la pirámide.",
                    fertility: "Reemplazo (2.3 hijos)",
                    // Total Recalibrado: 112.3M
                    male: [-0.45, -0.60, -0.85, -1.15, -1.50, -1.95, -2.45, -3.05, -3.75, -4.50, -5.25, -5.85, -6.25, -6.55, -6.75, -6.85, -6.80, -6.70],
                    female: [0.60, 0.75, 1.00, 1.30, 1.70, 2.15, 2.65, 3.25, 3.95, 4.65, 5.35, 5.95, 6.35, 6.65, 6.85, 6.95, 6.90, 6.80]
                },
                {
                    year: 2020,
                    title: "Madurez Poblacional",
                    desc: "Población de 126.0M (Censo). Base contraída.",
                    fertility: "Baja (1.9 hijos)",
                    // Total Exacto: 126.0M
                    male: [-0.55, -0.70, -0.95, -1.35, -1.85, -2.40, -2.95, -3.55, -4.15, -4.65, -4.95, -5.15, -5.25, -5.30, -5.30, -5.25, -5.10, -4.90],
                    female: [0.70, 0.85, 1.10, 1.55, 2.05, 2.60, 3.15, 3.75, 4.35, 4.85, 5.15, 5.35, 5.45, 5.50, 5.50, 5.45, 5.30, 5.10]
                },
                {
                    year: 2030,
                    title: "Envejecimiento Acelerado",
                    desc: "Proyección: La población sigue creciendo hacia el pico, pero a menor ritmo.",
                    fertility: "Muy Baja (1.7 hijos)",
                    // Proyección Ajustada hacia 138M
                    male: [-0.80, -1.05, -1.45, -1.95, -2.55, -3.15, -3.75, -4.25, -4.75, -5.05, -5.25, -5.30, -5.25, -5.15, -5.00, -4.80, -4.60, -4.35],
                    female: [1.00, 1.30, 1.75, 2.30, 2.95, 3.55, 4.15, 4.65, 5.15, 5.45, 5.65, 5.70, 5.65, 5.55, 5.40, 5.20, 5.00, 4.75]
                },
                {
                    year: 2040,
                    title: "Invierno Demográfico",
                    desc: "Proyección: Acercándose al pico poblacional histórico.",
                    fertility: "Crítica (1.6 hijos)",
                    // Proyección Ajustada hacia 145M
                    male: [-1.20, -1.55, -2.05, -2.65, -3.25, -3.85, -4.35, -4.85, -5.15, -5.35, -5.45, -5.45, -5.35, -5.20, -5.00, -4.75, -4.50, -4.20],
                    female: [1.50, 1.95, 2.50, 3.15, 3.75, 4.35, 4.85, 5.35, 5.65, 5.85, 5.95, 5.95, 5.85, 5.70, 5.50, 5.25, 4.95, 4.60]
                },
                {
                    year: 2050,
                    title: "La Urna Invertida",
                    desc: "Proyección: Estabilización y envejecimiento masivo.",
                    fertility: "Estancada (1.6 hijos)",
                    // Proyección Ajustada hacia 148M
                    male: [-1.80, -2.25, -2.85, -3.45, -4.05, -4.55, -4.95, -5.25, -5.45, -5.55, -5.55, -5.45, -5.30, -5.10, -4.85, -4.55, -4.25, -3.95],
                    female: [2.20, 2.75, 3.45, 4.05, 4.65, 5.15, 5.55, 5.85, 6.05, 6.15, 6.15, 6.05, 5.90, 5.70, 5.45, 5.15, 4.85, 4.55]
                }
            ];

            // --- CONFIGURACIÓN DE CHART.JS (Sin Cambios) ---
            const ctx = document.getElementById('pyramidChart').getContext('2d');
            const slider = document.getElementById('yearSlider');
            const yearDisplay = document.getElementById('yearDisplay');
            const analysisTitle = document.getElementById('analysisTitle');
            const analysisText = document.getElementById('analysisText');
            const fertilityText = document.getElementById('fertilityText');
            const analysisBox = document.getElementById('analysisBox');
            const popLabel = document.getElementById('popLabel');
            
            const totalPopDisplay = document.getElementById('totalPop');
            const malePopDisplay = document.getElementById('malePop');
            const femalePopDisplay = document.getElementById('femalePop');
            const dependencyText = document.getElementById('dependencyText');
            const agingText = document.getElementById('agingText');

            const chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ageGroups,
                    datasets: [
                        { label: 'Hombres', data: [], backgroundColor: '#4f46e5', borderRadius: { topLeft: 4, bottomLeft: 4 }, barPercentage: 0.9 },
                        { label: 'Mujeres', data: [], backgroundColor: '#e11d48', borderRadius: { topRight: 4, bottomRight: 4 }, barPercentage: 0.9 }
                    ]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { stacked: true, min: -8, max: 8, grid: { color: '#f1f5f9' }, ticks: { callback: v => Math.abs(v) + 'M', font: { family: 'Inter', weight: 'bold' } } },
                        y: { stacked: true, grid: { display: false }, ticks: { font: { family: 'Inter', size: 11, weight: 'bold' } }, reverse: false }
                    },
                    plugins: {
                        legend: { position: 'top' },
                        tooltip: { callbacks: { label: ctx => ctx.dataset.label + ': ' + Math.abs(ctx.raw).toFixed(1) + ' Millones' } }
                    }
                }
            });

            function updateDashboard(index) {
                if (!database[index]) return;
                const data = database[index];
                
                if (yearDisplay) yearDisplay.textContent = data.year;
                if (analysisTitle) analysisTitle.textContent = data.title;
                if (analysisText) analysisText.textContent = data.desc;
                if (fertilityText) fertilityText.textContent = data.fertility;
                
                if (popLabel) popLabel.textContent = data.year <= 2020 ? 'Población Censada' : 'Población Proyectada';

                if (analysisBox) {
                    analysisBox.classList.remove('border-indigo-500');
                    void analysisBox.offsetWidth;
                    analysisBox.classList.add('border-indigo-500');
                }

                chart.data.datasets[0].data = data.male;
                chart.data.datasets[1].data = data.female;
                chart.update();

                // Cálculos
                const malesAbs = data.male.map(Math.abs);
                const femalesAbs = data.female;
                const totalPerGroup = malesAbs.map((num, idx) => num + femalesAbs[idx]);
                const totalPopulation = malesAbs.reduce((a, b) => a + b, 0) + femalesAbs.reduce((a, b) => a + b, 0);

                const pop0to14 = totalPerGroup[15] + totalPerGroup[16] + totalPerGroup[17];
                const pop65plus = totalPerGroup[0] + totalPerGroup[1] + totalPerGroup[2] + totalPerGroup[3] + totalPerGroup[4];
                const pop15to64 = totalPopulation - pop0to14 - pop65plus;

                if (totalPopDisplay) totalPopDisplay.textContent = totalPopulation.toFixed(1) + ' M';
                if (malePopDisplay) malePopDisplay.textContent = malesAbs.reduce((a, b) => a + b, 0).toFixed(1) + ' M';
                if (femalePopDisplay) femalePopDisplay.textContent = femalesAbs.reduce((a, b) => a + b, 0).toFixed(1) + ' M';
                if (dependencyText) dependencyText.textContent = ((pop0to14 + pop65plus) / pop15to64 * 100).toFixed(1) + '%';
                if (agingText) agingText.textContent = (pop65plus / totalPopulation * 100).toFixed(1) + '%';
            }

            if (slider) slider.addEventListener('input', (e) => updateDashboard(e.target.value));
            updateDashboard(6); // 2020
        });

        function downloadImage() {
            const container = document.getElementById('dashboard-container');
            if (!container) return;
            html2canvas(container, { scale: 2, useCORS: true, backgroundColor: "#ffffff" }).then(canvas => {
                const year = document.getElementById('yearDisplay').textContent;
                const link = document.createElement('a');
                link.download = `piramide_poblacion_mexico_${year}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }
    </script>
</body>
</html>
