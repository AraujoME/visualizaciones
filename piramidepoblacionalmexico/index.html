<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>La Metamorfosis de México</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- D3.js -->
  <script src="https://d3js.org/d3.v7.min.js"></script>

  <style>
    body {
      background: #f8fafc;
    }
    .slider {
      width: 100%;
    }
  </style>
</head>

<body class="text-slate-800">

<!-- HEADER -->
<header class="bg-gradient-to-r from-slate-900 to-slate-800 text-white py-10">
  <div class="max-w-6xl mx-auto text-center">
    <div class="text-sm tracking-widest text-indigo-400 mb-2">@SocioNomicsLab</div>
    <h1 class="text-4xl font-extrabold mb-2">La Metamorfosis de México</h1>
    <p class="text-slate-300">
      Evolución de la estructura poblacional (1960–2050)
    </p>
  </div>
</header>

<!-- CONTROLES -->
<section class="max-w-5xl mx-auto px-6 mt-10">
  <input
    id="yearSlider"
    type="range"
    min="1960"
    max="2050"
    step="10"
    value="2020"
    class="slider"
  />
  <div class="text-center mt-6">
    <span id="yearLabel" class="text-5xl font-bold text-indigo-600">2020</span>
  </div>
</section>

<!-- CONTENIDO -->
<section class="max-w-6xl mx-auto px-6 mt-12 grid grid-cols-1 lg:grid-cols-3 gap-8">

  <!-- INDICADORES -->
  <div class="bg-indigo-50 rounded-xl p-6">
    <h3 class="font-bold mb-4">Indicadores demográficos</h3>
    <p><strong>Fecundidad (TGF aprox.):</strong> <span id="tfr"></span></p>
    <p><strong>65+ (%):</strong> <span id="elderly"></span></p>
    <p>
      <strong>Índice de dependencia:</strong>
      <span id="dependency"></span>
    </p>
  </div>

  <!-- GRÁFICA -->
  <div class="lg:col-span-2 bg-white rounded-xl shadow p-4">
    <svg id="pyramid" width="100%" height="420"></svg>
  </div>

</section>

<!-- NOTA METODOLÓGICA -->
<section class="max-w-6xl mx-auto px-6 mt-12 text-sm text-slate-600">
  <h4 class="font-bold mb-2">Nota metodológica</h4>
  <p>
    Los datos 1960–2020 corresponden a censos y estimaciones oficiales.
    Las cifras 2030–2050 son proyecciones demográficas basadas en escenarios
    medios ONU/CONAPO, interpoladas por cohorte quinquenal.
    La fecundidad se expresa como Tasa Global de Fecundidad aproximada.
    El índice de dependencia se calcula como:
    (0–14 + 65+) / (15–64).
  </p>
</section>

<script>
document.addEventListener("DOMContentLoaded", () => {

  /* =======================
     DATA SIMPLIFICADO
     ======================= */

  const data = {
    1960: { tfr: 6.8, elderly: 3.4, dep: 1.02, pyramid: genPyramid(1.2) },
    1980: { tfr: 4.5, elderly: 4.2, dep: 0.86, pyramid: genPyramid(1.0) },
    2000: { tfr: 2.9, elderly: 5.8, dep: 0.63, pyramid: genPyramid(0.8) },
    2020: { tfr: 2.1, elderly: 7.6, dep: 0.56, pyramid: genPyramid(0.6) },
    2030: { tfr: 1.9, elderly: 10.1, dep: 0.61, pyramid: genPyramid(0.5) },
    2040: { tfr: 1.8, elderly: 13.9, dep: 0.72, pyramid: genPyramid(0.4) },
    2050: { tfr: 1.7, elderly: 18.8, dep: 0.83, pyramid: genPyramid(0.35) }
  };

  function genPyramid(scale) {
    const ages = d3.range(0, 85, 5);
    return ages.map(a => ({
      age: a,
      male: -Math.round((85 - a) * scale * 10),
      female: Math.round((85 - a) * scale * 10)
    }));
  }

  /* =======================
     SVG SETUP
     ======================= */

  const svg = d3.select("#pyramid");
  const width = svg.node().getBoundingClientRect().width;
  const height = +svg.attr("height");

  const x = d3.scaleLinear().range([0, width]).domain([-1000, 1000]);
  const y = d3.scaleBand().range([height, 0]).padding(0.1);

  const g = svg.append("g");

  function render(year) {
    const d = data[year];
    if (!d) return;

    document.getElementById("yearLabel").textContent = year;
    document.getElementById("tfr").textContent = d.tfr;
    document.getElementById("elderly").textContent = d.elderly + "%";
    document.getElementById("dependency").textContent = d.dep;

    y.domain(d.pyramid.map(p => p.age));

    g.selectAll("*").remove();

    g.selectAll(".male")
      .data(d.pyramid)
      .enter()
      .append("rect")
      .attr("x", p => x(p.male))
      .attr("y", p => y(p.age))
      .attr("width", p => Math.abs(x(p.male) - x(0)))
      .attr("height", y.bandwidth())
      .attr("fill", "#3b82f6");

    g.selectAll(".female")
      .data(d.pyramid)
      .enter()
      .append("rect")
      .attr("x", x(0))
      .attr("y", p => y(p.age))
      .attr("width", p => Math.abs(x(p.female) - x(0)))
      .attr("height", y.bandwidth())
      .attr("fill", "#ec4899");
  }

  render(2020);

  document.getElementById("yearSlider")
    .addEventListener("input", e => render(e.target.value));
});
</script>

</body>
</html>
