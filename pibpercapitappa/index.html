<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SocioNomicsLab | Auditoría PIB PPA Interactiva</title>
    
    <!-- Tailwind para Estilos -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React y ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <!-- Babel para compilar JSX en el navegador -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- html2canvas para la descarga de PNG -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; overflow-x: hidden; }
        
        /* Animación suave para el tooltip */
        .tooltip-base {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s cubic-bezier(0.23, 1, 0.32, 1), transform 0.4s cubic-bezier(0.23, 1, 0.32, 1);
        }
        .tooltip-active {
            opacity: 1;
        }
        
        .data-point { 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            cursor: pointer; 
        }
        .data-point:hover { 
            r: 8; 
            filter: brightness(1.2) drop-shadow(0 0 8px rgba(99, 102, 241, 0.6)); 
        }
    </style>
</head>
<body class="bg-slate-100">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef } = React;

        const TrendingUp = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>
        );
        const Download = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
        );

        const DATA_HISTORICA = [
            { year: 2010, usa: 48500, rus: 20500, mex: 15200, chi: 9300, nota: "Recuperación post-crisis financiera global." },
            { year: 2012, usa: 51600, rus: 23300, mex: 16700, chi: 11200, nota: "Crisis de deuda en la Eurozona impacta mercados." },
            { year: 2014, usa: 55000, rus: 24800, mex: 17600, chi: 13200, nota: "Caída drástica en precios del petróleo." },
            { year: 2016, usa: 58000, rus: 24100, mex: 18600, chi: 15300, nota: "Aumento de tensiones comerciales globales." },
            { year: 2018, usa: 62800, rus: 28700, mex: 19900, chi: 17600, nota: "Máximo histórico de crecimiento pre-pandemia." },
            { year: 2020, usa: 63500, rus: 29900, mex: 19300, chi: 17200, nota: "Shock por COVID-19: Recesión global sincronizada." },
            { year: 2022, usa: 76200, rus: 36500, mex: 22800, chi: 21400, nota: "Inflación post-pandemia y conflicto en Ucrania." },
            { year: 2024, usa: 85400, rus: 38300, mex: 25900, chi: 25000, nota: "Hito de convergencia: China iguala el estándar real de México." }
        ];

        const LegendItem = ({ color, label, dash }) => (
            <div className="flex items-center gap-2">
                <div className={`w-8 md:w-12 h-1.5 ${color} ${dash ? 'border-t-2 border-dashed border-white' : 'rounded-full'}`}></div>
                <span className="text-[10px] md:text-[12px] font-black text-slate-500 uppercase tracking-widest leading-none">{label}</span>
            </div>
        );

        function App() {
            const [isExporting, setIsExporting] = useState(false);
            const [hoveredData, setHoveredData] = useState(null);
            const exportRef = useRef(null);

            const handleDownload = async () => {
                setIsExporting(true);
                setTimeout(async () => {
                    const element = exportRef.current;
                    const canvas = await html2canvas(element, { scale: 3, backgroundColor: '#ffffff' });
                    const link = document.createElement('a');
                    link.download = `SocioNomicsLab_PIB_PPA_Audit.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    setIsExporting(false);
                }, 100);
            };

            const maxVal = 95000;
            const width = 800; 
            const height = 500;

            const getPoints = (key) => {
                return DATA_HISTORICA.map((d, i) => {
                    const x = (i / (DATA_HISTORICA.length - 1)) * width;
                    const y = height - (d[key] / maxVal) * height;
                    return `${x},${y}`;
                }).join(' ');
            };

            // Lógica de posicionamiento para evitar desbordes laterales
            const getTooltipStyle = () => {
                if (!hoveredData) return { opacity: 0, transform: 'translateY(10px)' };
                
                const percent = (hoveredData.index / (DATA_HISTORICA.length - 1)) * 100;
                let translateX = '-50%';
                
                if (hoveredData.index === 0) translateX = '0%';
                if (hoveredData.index === DATA_HISTORICA.length - 1) translateX = '-100%';

                return {
                    left: `${percent}%`,
                    top: '-40px',
                    transform: `translate(${translateX}, 0)`,
                    opacity: 1
                };
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4 md:p-8">
                    <div ref={exportRef} className="w-full max-w-[1050px] bg-white border border-slate-200 shadow-2xl overflow-hidden rounded-[2.5rem] relative">
                        
                        <div className="bg-slate-950 px-10 py-12 text-white border-b-8 border-indigo-600 flex flex-col md:flex-row justify-between items-center gap-6 relative overflow-hidden">
                            <div className="absolute top-0 right-0 w-80 h-80 bg-indigo-600 rounded-full blur-[100px] opacity-20 -mr-40 -mt-40"></div>
                            <div className="relative z-10 flex items-center gap-6">
                                <div className="p-4 bg-indigo-600 rounded-2xl shadow-xl"><TrendingUp /></div>
                                <div>
                                    <p className="text-[10px] font-black uppercase tracking-[0.4em] text-indigo-400 leading-none">Global Economic Audit</p>
                                    <h1 className="text-3xl md:text-4xl font-black italic tracking-tighter uppercase leading-none mt-1">PIB Per Cápita <span className="text-indigo-500 underline decoration-white decoration-2 underline-offset-4">PPA</span></h1>
                                </div>
                            </div>
                            <div className="relative z-10 text-right">
                                <p className="text-3xl font-black italic tracking-tighter uppercase leading-none">@SocioNomicsLab</p>
                                <p className="text-[10px] text-slate-500 font-bold uppercase tracking-widest mt-2 leading-none">Intelligence for Impact</p>
                            </div>
                        </div>

                        <div className="p-10 space-y-10 relative">
                            <div className="space-y-4">
                                <div className="flex justify-between items-center flex-wrap gap-4">
                                    <div className="flex gap-6 flex-wrap">
                                        <LegendItem color="bg-slate-900" label="EEUU" />
                                        <LegendItem color="bg-indigo-500" label="Rusia (Auditado)" dash />
                                        <LegendItem color="bg-emerald-500" label="México" />
                                        <LegendItem color="bg-rose-500" label="China" />
                                    </div>
                                    <p className="text-[10px] font-black text-indigo-600 bg-indigo-50 px-4 py-2 rounded-full uppercase tracking-widest italic animate-pulse hidden md:block">
                                        Explora los nodos para ver detalles históricos
                                    </p>
                                </div>

                                <div className="relative h-[300px] md:h-[500px] mt-8">
                                    {/* Tooltip optimizado: Alineación dinámica para evitar desbordes */}
                                    <div 
                                        className="absolute z-50 hidden md:block bg-slate-900 text-white p-6 rounded-[2rem] shadow-2xl border border-indigo-500/30 pointer-events-none min-w-[300px] max-w-[340px] tooltip-base"
                                        style={getTooltipStyle()}
                                    >
                                        {hoveredData && (
                                            <React.Fragment>
                                                <div className="flex justify-between items-center gap-4 mb-3">
                                                    <p className="text-[12px] font-black text-indigo-400 uppercase tracking-widest leading-none italic">{hoveredData.year}</p>
                                                    <div className="w-2 h-2 rounded-full bg-indigo-500 animate-pulse"></div>
                                                </div>
                                                <p className="text-[13px] font-bold italic leading-relaxed mb-5 text-slate-300 border-b border-white/10 pb-4">
                                                    {hoveredData.nota}
                                                </p>
                                                
                                                <div className="grid grid-cols-2 gap-x-8 gap-y-4">
                                                    <div className="flex flex-col">
                                                        <span className="text-[9px] text-slate-500 font-black uppercase tracking-widest mb-1">EEUU</span>
                                                        <span className="text-base font-black text-white italic">${hoveredData.usa.toLocaleString()}</span>
                                                    </div>
                                                    <div className="flex flex-col">
                                                        <span className="text-[9px] text-indigo-400 font-black uppercase tracking-widest mb-1">RUSIA</span>
                                                        <span className="text-base font-black text-indigo-200 italic">${hoveredData.rus.toLocaleString()}</span>
                                                    </div>
                                                    <div className="flex flex-col">
                                                        <span className="text-[9px] text-emerald-400 font-black uppercase tracking-widest mb-1">MÉXICO</span>
                                                        <span className="text-base font-black text-emerald-100 italic">${hoveredData.mex.toLocaleString()}</span>
                                                    </div>
                                                    <div className="flex flex-col">
                                                        <span className="text-[9px] text-rose-400 font-black uppercase tracking-widest mb-1">CHINA</span>
                                                        <span className="text-base font-black text-rose-100 italic">${hoveredData.chi.toLocaleString()}</span>
                                                    </div>
                                                </div>
                                            </React.Fragment>
                                        )}
                                    </div>

                                    <svg viewBox={`0 0 ${width + 150} ${height}`} className="w-full h-full overflow-visible">
                                        {[0, 0.25, 0.5, 0.75, 1].map((v, i) => (
                                            <line key={i} x1="0" y1={height * v} x2={width} y2={height * v} stroke="#f1f5f9" strokeWidth="2" />
                                        ))}

                                        <polyline points={getPoints('usa')} fill="none" stroke="#0f172a" strokeWidth="6" strokeLinecap="round" strokeLinejoin="round" />
                                        <polyline points={getPoints('rus')} fill="none" stroke="#6366f1" strokeWidth="4" strokeDasharray="10 5" strokeLinecap="round" strokeLinejoin="round" />
                                        <polyline points={getPoints('mex')} fill="none" stroke="#10b981" strokeWidth="6" strokeLinecap="round" strokeLinejoin="round" />
                                        <polyline points={getPoints('chi')} fill="none" stroke="#f43f5e" strokeWidth="6" strokeLinecap="round" strokeLinejoin="round" />

                                        {DATA_HISTORICA.map((d, i) => {
                                            const x = (i / (DATA_HISTORICA.length - 1)) * width;
                                            return (
                                                <g key={i} onMouseEnter={() => setHoveredData({...d, index: i})} onMouseLeave={() => setHoveredData(null)}>
                                                    <text x={x} y={height + 35} className="text-[14px] font-black fill-slate-400 italic" textAnchor="middle">{d.year}</text>
                                                    <circle cx={x} cy={height - (d.usa / maxVal) * height} r="4" fill="#0f172a" className="data-point" />
                                                    <circle cx={x} cy={height - (d.rus / maxVal) * height} r="4" fill="#6366f1" className="data-point" />
                                                    <circle cx={x} cy={height - (d.mex / maxVal) * height} r="5" fill="#10b981" className="data-point stroke-white stroke-2 shadow-xl" />
                                                    <circle cx={x} cy={height - (d.chi / maxVal) * height} r="4" fill="#f43f5e" className="data-point" />
                                                    <rect x={x - 25} y="0" width="50" height={height} fill="transparent" className="cursor-pointer" />
                                                </g>
                                            );
                                        })}
                                        
                                        <g className="text-[15px] font-black italic tabular-nums">
                                            <text x={width + 80} y={height - (DATA_HISTORICA[7].usa/maxVal)*height + 5} className="fill-slate-950 font-black">$85,400</text>
                                            <text x={width + 80} y={height - (DATA_HISTORICA[7].rus/maxVal)*height + 5} className="fill-indigo-600 font-black">$38,300</text>
                                            <text x={width + 80} y={height - (DATA_HISTORICA[7].mex/maxVal)*height - 5} className="fill-emerald-600 font-black">$25,900</text>
                                            <text x={width + 80} y={height - (DATA_HISTORICA[7].chi/maxVal)*height + 15} className="fill-rose-600 font-black">$25,000</text>
                                        </g>
                                    </svg>
                                </div>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-8 pt-6 border-t border-slate-100">
                                <div className="bg-slate-50 p-8 rounded-3xl border border-slate-100 shadow-inner space-y-4">
                                    <h3 className="text-[11px] font-black uppercase tracking-[0.2em] text-indigo-600 leading-none italic">Nota Técnica de Auditoría</h3>
                                    <div className="space-y-3">
                                        <p className="text-[12px] text-slate-600 font-bold leading-relaxed italic">
                                            <span className="text-slate-950 uppercase">Paridad de Poder Adquisitivo (PPA):</span> Ajuste que permite que $1 dólar "rinda" lo mismo en México que en EEUU, eliminando la distorsión del tipo de cambio para medir bienestar real.
                                        </p>
                                        <p className="text-[12px] text-slate-600 font-bold leading-relaxed italic border-t border-slate-200 pt-3">
                                            <span className="text-indigo-600 uppercase italic underline underline-offset-4 leading-none">Referencia 2024:</span> Se utiliza este año como corte de auditoría por presentar las <span className="font-black text-slate-900 italic">cifras consolidadas</span> más recientes de los organismos internacionales, ofreciendo un escenario de comparación estable.
                                        </p>
                                        <p className="text-[12px] text-slate-500 font-bold leading-relaxed italic border-t border-slate-200 pt-2">
                                            Fuentes: FMI (WEO Oct 2024), Banco Mundial y auditoría @SocioNomicsLab.
                                        </p>
                                    </div>
                                </div>
                                <div className="flex flex-col justify-center items-end gap-5">
                                    <div className="flex gap-2">
                                        <div className="w-11 h-11 bg-slate-950 rounded-xl flex items-center justify-center text-white text-[11px] font-black italic shadow-lg">CC</div>
                                        <div className="w-11 h-11 bg-slate-950 rounded-xl flex items-center justify-center text-white text-[11px] font-black italic shadow-lg">BY</div>
                                        <div className="w-11 h-11 bg-slate-950 rounded-xl flex items-center justify-center text-white text-[11px] font-black italic shadow-lg">NC</div>
                                        <div className="w-11 h-11 bg-indigo-600 rounded-xl flex items-center justify-center text-white text-[9px] font-black italic shadow-lg leading-none text-center">MIT<br/>LIC</div>
                                    </div>
                                    <div className="text-right">
                                        <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest italic">Licencia MIT & CC BY-NC 4.0</p>
                                        <p className="text-[11px] font-black text-indigo-600 uppercase tracking-widest mt-1">Data Driven Human Impact • 2025</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="bg-slate-50 px-10 py-6 border-t border-slate-100 flex justify-between items-center">
                            <span className="text-[10px] font-black text-slate-400 uppercase tracking-widest italic">Análisis por Eric Araujo Martínez • Licencia MIT</span>
                            <span className="text-[11px] font-black text-indigo-600 uppercase tracking-widest italic tracking-tighter">@SocioNomicsLab</span>
                        </div>
                    </div>

                    <button 
                        onClick={handleDownload}
                        className="mt-8 bg-slate-950 text-white px-12 py-5 rounded-2xl font-black text-sm uppercase tracking-widest hover:bg-indigo-700 transition-all flex items-center gap-4 shadow-2xl"
                    >
                        {isExporting ? "Generando Reporte..." : <React.Fragment><Download /> Bajar Reporte PNG</React.Fragment>}
                    </button>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
